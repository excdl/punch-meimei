<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>智能打卡</title>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<style>
body{background:#eef2f7;font-family:"Microsoft JhengHei";display:flex;justify-content:center;padding:20px}
.card{background:#fff;border-radius:20px;padding:25px;width:100%;max-width:420px;text-align:center;box-shadow:0 10px 25px rgba(0,0,0,.15)}
.circle{width:140px;height:140px;border-radius:50%;font-size:26px;border:none;color:#fff;cursor:pointer;box-shadow:0 6px 12px rgba(0,0,0,.25)}
.on{background:#3498db}.off{background:#2ecc71}
</style>
</head>
<body>

<div class="card">
  <h2 id="user">載入中...</h2>
  <p id="info"></p>
  <button id="btn" class="circle on">上班</button>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbzSxc1UyM75jxbVe1lg1dNKkxvQqrP92xmDz47lLYXDXGoBx3aQ9s_Rejy0I6UPStup/exec";
let isIn = true, userId="", userName="";

liff.init({ liffId:"你的LIFF_ID" }).then(async()=>{
  if(!liff.isLoggedIn()) liff.login();
  const p = await liff.getProfile();
  userId = p.userId;
  userName = p.displayName;
  document.getElementById("user").innerText = userName;
});

document.getElementById("btn").onclick = ()=>{
  navigator.geolocation.getCurrentPosition(async pos=>{
    const res = await fetch(API,{
      method:"POST",
      body:JSON.stringify({
        userId,
        userName,
        status: isIn?"上班":"下班",
        ip:"",
        gps:{lat:pos.coords.latitude,lng:pos.coords.longitude}
      })
    });
    const data = await res.json();

    if(data.reject){
      Swal.fire("提示",data.message,"warning");
      return;
    }

    Swal.fire({
      icon: data.fakeGps?"error":(data.rangeStatus==="正常"?"success":"warning"),
      title: data.message,
      html: `公司：${data.nearestCompany}<br>距離：${data.distance}m`
    });

    isIn = !isIn;
    const btn = document.getElementById("btn");
    btn.innerText = isIn?"上班":"下班";
    btn.className = "circle " + (isIn?"on":"off");
  });
};
</script>
</body>
</html>










































































































































































































































































