<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å¥‡å¯æ™ºèƒ½æ‰“å¡ç³»çµ±</title>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<style>
body{ font-family:Arial; text-align:center; padding:30px; background:#f7f7f7; }
button{ padding:15px 30px; margin:15px; font-size:22px; border:none; border-radius:12px; cursor:pointer; font-weight:bold; }
#gpsBtn{ background:linear-gradient(135deg,#3498db,#2980b9); color:white; }
#ipBtn{ background:linear-gradient(135deg,#2ecc71,#27ae60); color:white; }
#btnClock{ font-size:24px; border-radius:50%; width:120px; height:120px; }
</style>
</head>
<body>

<h2 id="userInfo">æ­£åœ¨ç²å–ä½¿ç”¨è€…è³‡è¨Š...</h2>

<div id="methodSelection">
    <p>è«‹é¸æ“‡æ‰“å¡æ–¹å¼ï¼š</p>
    <button id="gpsBtn">ğŸ“ GPS æ‰“å¡</button>
    <button id="ipBtn">ğŸŒ IP æ‰“å¡</button>
</div>

<div id="clockInPage" style="display:none;">
    <h3 id="statusInfo"></h3>
    <p id="dateTime"></p>
    <button id="btnClock">ä¸Šç­</button>
</div>

<script>
let userId = "", userName = "";
const API_ENDPOINT = "https://script.google.com/macros/s/AKfycbwk2LB11_0CE8S-8dVMZp3hWtfrDtYVMm2lnAwH2n9OMUMumVbv-J9tn9VpLsQDv9ra/exec";

async function initLIFF(){
    await liff.init({ liffId:"YOUR_LIFF_ID" });
    if(!liff.isLoggedIn()) await liff.login();
    const profile = await liff.getProfile();
    userId = profile.userId;
    userName = profile.displayName;
    document.getElementById("userInfo").textContent = userName + " æ‚¨å¥½";
}
initLIFF();

document.getElementById("gpsBtn").onclick = () => openClockPage("gps");
document.getElementById("ipBtn").onclick = () => openClockPage("ip");

function openClockPage(method){
    document.getElementById("methodSelection").style.display = "none";
    document.getElementById("clockInPage").style.display = "block";
    document.getElementById("statusInfo").textContent = method.toUpperCase() + " æ‰“å¡æ¨¡å¼";
    const btnClock = document.getElementById("btnClock");
    btnClock.dataset.method = method;
    updateDateTime();
    setInterval(updateDateTime,1000);
    btnClock.onclick = async () => {
        if(method==="gps") await performGPSClockIn();
        else await performIPClockIn();
    }
}

function updateDateTime(){
    const now = new Date();
    document.getElementById("dateTime").textContent = now.toLocaleString("zh-TW",{hour12:false});
}

async function performGPSClockIn(){
    if(!navigator.geolocation){
        Swal.fire({icon:"error",title:"GPS ä¸æ”¯æ´"});
        return;
    }
    navigator.geolocation.getCurrentPosition(async pos=>{
        const lat=pos.coords.latitude, lng=pos.coords.longitude;
        const res = await fetch(API_ENDPOINT,{
            method:"POST",
            body: JSON.stringify({userId,userName,status:"ä¸Šç­",method:"gps",gps:{lat,lng}})
        });
        const data = await res.json();
        Swal.fire({icon:"success",title:data.message, html:`æ‰“å¡æ™‚é–“ï¼š${data.date} ${data.time}`});
    },err=>{
        Swal.fire({icon:"error",title:"GPS å–å¾—å¤±æ•—"});
    });
}

async function performIPClockIn(){
    const ipRes = await fetch("https://api.ipify.org?format=json");
    const ipData = await ipRes.json();
    const res = await fetch(API_ENDPOINT,{
        method:"POST",
        body: JSON.stringify({userId,userName,status:"ä¸Šç­",method:"ip",ip:ipData.ip})
    });
    const data = await res.json();
    Swal.fire({icon:"success",title:data.message, html:`æ‰“å¡æ™‚é–“ï¼š${data.date} ${data.time}`});
}
</script>
</body>
</html>





































































































































